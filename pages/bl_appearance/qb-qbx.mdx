import { Steps } from 'nextra/components'

<Steps>

### IT IS HIGHLY RECOMMEND THAT YOU DONT RELY ON BACKWARDS compatibility

### 1. If you want to start fresh. Remove previous appearance/clothing system skip 

### 2. If you dont want to deal with backwards compatibility.

### 2.a `qb-clothing`
    - Go to `qb-clothing/client/main.lua` and comment out everything inside `openMenu` function. Like below:
        ```lua
        local function openMenu(allowedMenus)
            -- previousSkinData = json.encode(skinData)
            -- creatingCharacter = true
            -- PlayerData = QBCore.Functions.GetPlayerData()
            -- local trackerMeta = PlayerData.metadata["tracker"]
            -- local translations = {}
            -- for k in pairs(Lang.fallback and Lang.fallback.phrases or Lang.phrases) do
            --     if k:sub(0, ('ui.'):len()) then
            --         translations[k:sub(('ui.'):len() + 1)] = Lang:t(k)
            --     end
            -- end
            -- GetMaxValues()
            -- SendNUIMessage({
            --     action = "open",
            --     menus = allowedMenus,
            --     currentClothing = skinData,
            --     hasTracker = trackerMeta,
            --     translations = translations,
            -- })
            -- SetNuiFocus(true, true)
            -- SetCursorLocation(0.9, 0.25)
            -- FreezeEntityPosition(PlayerPedId(), true)
            -- enableCam()
        end
        ```

    - Got to `qb-clothing/client/main.lua` around `line 1437` change the `QBCore:Client:OnPlayerLoaded` event to the following:
    ```lua
    RegisterNetEvent('QBCore:Client:OnPlayerLoaded', function()
        -- TriggerServerEvent("qb-clothes:loadPlayerSkin")
        PlayerData = QBCore.Functions.GetPlayerData()
        exports.bl_appearance:SetPlayerPedAppearance(PlayerData.citizenid)
        -- loadStores()
    end)
    ```
    - We need to keep the resource functioning but only when we need it
    - Got to `qb-clothing/client/main.lua` around `line 1582`, above the `refreshskin` command add `--[[` and `]]` at the end of the file. Like below:
    ```lua
        --[[
        -- Commands
        RegisterCommand("refreshskin", function()
        ...
        ]]
    ```

###  Modify `qb-multicharacter:server:getSkin` Callback
    - Go to the callback definition around `line 183` in `server/main.lua`
    - Change:
        ```lua
        local result = MySQL.query.await('SELECT * FROM playerskins WHERE citizenid = ? AND active = ?', {cid, 1})
        ```
        To:
        ```lua
        local result = MySQL.query.await('SELECT * FROM appearance WHERE id = ?', {cid})
        ```

### Modify `cDataPed` RegisterNUICallback
    - Go to the `cDataPed` callback around `line 203` in `client/main.lua`. Replace the event with the following:
    ```lua
    RegisterNUICallback('cDataPed', function(nData, cb)
        local cData = nData.cData
        SetEntityAsMissionEntity(charPed, true, true)
        DeleteEntity(charPed)
        if cData ~= nil then
            if not cached_player_skins[cData.citizenid] then

                local data = exports.bl_appearance:GetPlayerPedAppearance(cData.citizenid)

                cached_player_skins[cData.citizenid] = {model = data.model, data = data}
            end

            local model = cached_player_skins[cData.citizenid].model
            local data = cached_player_skins[cData.citizenid].data

            model = model ~= nil and tonumber(model) or false

            if model ~= nil then
                initializePedModel(model, json.decode(data))
            else
                initializePedModel()
            end
            cb("ok")
        else
            initializePedModel()
            cb("ok")
        end
    end)
    ```

</Steps>